<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>{% block title %}Ù†Ø¸Ø§Ù… Ø§Ù„ÙƒØ§ÙØªÙŠØ±ÙŠØ§ Ù„ÙŠÙ…ÙˆÙ†{% endblock %}</title>
    {% load static %}
    <link rel="stylesheet" href="{% static 'css/bootstrap.rtl.min.css' %}">
    
    <link rel="stylesheet" href="{% static 'css/style.css' %}">

    {% block extra_css %}{% endblock %}
</head>
<body>

<nav class="navbar navbar-expand-lg navbar-dark bg-dark lemon-navbar mb-4">
    <div class="container-fluid">

        <!-- Brand -->
        <div class="d-flex align-items-center gap-2">
            <span class="navbar-logo">ğŸ‹</span>
            <span class="navbar-brand fw-bold">
                Ù†Ø¸Ø§Ù… ÙƒØ§ÙØªÙŠØ±ÙŠØ§ Ù„ÙŠÙ…ÙˆÙ†
            </span>
        </div>

        {% if user.is_authenticated %}
        <div class="d-flex gap-3 align-items-center">

            <!-- ğŸ  Home (based on user role) -->
            {% if user.role == 'manager' %}
                <a href="{% url 'manager_dashboard' %}"
                   class="btn btn-outline-success btn-sm">
                    ğŸ  Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© 
                </a>
            {% elif user.role == 'cashier' %}
                <a href="{% url 'cashier_dashboard' %}"
                   class="btn btn-outline-success btn-sm">
                    ğŸ   Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
                </a>
            {% endif %}

            <!-- ğŸ”™ Back -->
            <a href="javascript:history.back()"
               class="btn btn-outline-light btn-sm">
                ğŸ”™ Ø±Ø¬ÙˆØ¹
            </a>

            <!-- ğŸšª Logout -->
            <a href="{% url 'logout' %}"
               class="btn btn-outline-danger btn-sm">
                ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬
            </a>

        </div>
        {% endif %}

    </div>
</nav>


<div class="container">
    {% block content %}{% endblock %}
</div>

{% if messages %}
<div class="container mt-3">
    {% for message in messages %}
        <div class="alert alert-{{ message.tags }}">
            {{ message }}
        </div>
    {% endfor %}
</div>
{% endif %}

<!-- âœ… Global Confirm Modal -->
<div id="confirmOverlay" class="confirm-overlay d-none">
  <div class="confirm-modal" role="dialog" aria-modal="true" aria-labelledby="confirmTitle">
    <div class="confirm-header">
      <div class="confirm-icon">âš ï¸</div>
      <div>
        <div id="confirmTitle" class="confirm-title">ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©</div>
        <div id="confirmMsg" class="confirm-msg">Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ØŸ</div>
      </div>
    </div>

    <div class="confirm-actions">
      <button type="button" id="confirmCancel" class="btn btn-outline-secondary btn-sm">
        Ø¥Ù„ØºØ§Ø¡
      </button>
      <button type="button" id="confirmOk" class="btn btn-danger btn-sm">
        Ù†Ø¹Ù…ØŒ Ø§Ø­Ø°Ù
      </button>
    </div>
  </div>
</div>

<script>
(function () {
  const overlay = document.getElementById('confirmOverlay');
  const msgEl = document.getElementById('confirmMsg');
  const btnOk = document.getElementById('confirmOk');
  const btnCancel = document.getElementById('confirmCancel');

  let pendingAction = null; // function to execute on confirm

  function openModal(message, actionFn) {
    pendingAction = actionFn;
    msgEl.textContent = message || 'Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ØŸ';
    overlay.classList.remove('d-none');
  }

  function closeModal() {
    pendingAction = null;
    overlay.classList.add('d-none');
  }

  // Close when clicking outside
  overlay.addEventListener('click', function (e) {
    if (e.target === overlay) closeModal();
  });

  btnCancel.addEventListener('click', closeModal);

  btnOk.addEventListener('click', function () {
    if (typeof pendingAction === 'function') {
      pendingAction();
    }
    closeModal();
  });

  // âœ… GLOBAL INTERCEPT (links + forms)
  document.addEventListener('click', function (e) {

    /* ---------- HANDLE LINKS ---------- */
    const link = e.target.closest('a.btn-danger');
    if (link && link.getAttribute('href')) {
      e.preventDefault();
      e.stopPropagation();

      const msg = link.getAttribute('data-msg') || 'Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ØŸ';
      openModal(msg, () => {
        window.location.href = link.href;
      });
      return;
    }

    /* ---------- HANDLE FORMS ---------- */
    const btn = e.target.closest('button.btn-danger');
    if (!btn) return;

    const form = btn.closest('form');
    if (!form) return;

    if (form.classList.contains('delete-item-form')) {
    return; // â›” Ù„Ø§ ØªØªØ¯Ø®Ù„
    }

    e.preventDefault();
    e.stopPropagation();

    const msg = btn.getAttribute('data-msg') || 'Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ØŸ';
    openModal(msg, () => {
      form.submit();
    });

  }, true);
})();
</script>

</body>
</html>
