{% extends "base.html" %}
{% block content %}

<h2>ğŸ§¾ Ø·Ù„Ø¨ Ø±Ù‚Ù… {{ ticket.id }}</h2>

<p>ğŸ‘¤ Ø§Ù„ÙƒØ§Ø´ÙŠØ±: <strong>{{ ticket.cashier.full_name }}</strong></p>

<hr>

<!-- ADD ITEM -->
<form method="POST">
    {% csrf_token %}

    <div class="row">
        <div class="col-md-6">
            <label>Ø§Ù„Ù…Ù†ØªØ¬</label>
            {{ form.product }}
        </div>

        <div class="col-md-3">
            <label>Ø§Ù„ÙƒÙ…ÙŠØ©</label>
            {{ form.quantity }}
        </div>

        <div class="col-md-3 d-flex align-items-end">
            <button class="btn btn-success w-100">â• Ø¥Ø¶Ø§ÙØ©</button>
        </div>
    </div>
</form>

<hr>

<!-- ITEMS TABLE -->
<table class="table table-bordered">
<tr>
    <th>Ø§Ù„Ù…Ù†ØªØ¬</th>
    <th>Ø§Ù„ÙƒÙ…ÙŠØ©</th>
    <th>Ø§Ù„Ø³Ø¹Ø±</th>
    <th>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</th>
    <th>Ø¥Ø¬Ø±Ø§Ø¡</th>
</tr>

{% for item in ticket.items.all %}
<tr>
    <td>{{ item.product.name }}</td>
    <td>{{ item.quantity }}</td>
    <td>{{ item.price }}</td>
    <td>{{ item.subtotal }}</td>
    <td>
        <!-- delete with manager PIN -->
        <form method="POST" action="{% url 'sales:delete_ticket_item' item.id %}">
            {% csrf_token %}
            <input type="hidden" name="manager_pin" id="manager_pin_input">
            <button class="btn btn-danger btn-sm" onclick="return confirmDelete();">
                ğŸ—‘
            </button>
        </form>
    </td>
</tr>
{% empty %}
<tr>
    <td colspan="5" class="text-center">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù†ØªØ¬Ø§Øª Ø¨Ø¹Ø¯</td>
</tr>
{% endfor %}
</table>

<h3>ğŸ’° Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: {{ ticket.total_amount }}</h3>

<hr>

<!-- PAYMENT -->
<form method="POST" action="{% url 'sales:close_ticket' ticket.id %}">
    {% csrf_token %}

    <label>Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹</label>
    <select name="payment_method" class="form-control mb-2" required>
        <option value="cash">Ù†Ù‚Ø¯Ø§Ù‹</option>
        <option value="transfer">ØªØ­ÙˆÙŠÙ„</option>
    </select>

    <label>Ø±Ù‚Ù… Ø§Ù„ØªØ­ÙˆÙŠÙ„ (Ø¥Ù† ÙˆØ¬Ø¯)</label>
    <input type="text" name="transfer_number" class="form-control mb-3">

    <button class="btn btn-primary w-100">
        âœ” ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø¯ÙØ¹ ÙˆØ¥ØºÙ„Ø§Ù‚ Ø§Ù„Ø·Ù„Ø¨
    </button>
</form>

<script>
function confirmDelete() {
    const pin = prompt("Ø£Ø¯Ø®Ù„ Ø±Ù…Ø² Ø§Ù„Ù…Ø¯ÙŠØ±:");
    if (!pin) return false;
    document.getElementById("manager_pin_input").value = pin;
    return true;
}
</script>

{% endblock %}
